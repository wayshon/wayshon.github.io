<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Cordova搭配Vue开发混合app实践 | Wayshon 小站</title>
    <meta name="description" content="Wayshon Front-End Developer">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    
    <link rel="preload" href="/assets/css/0.styles.f9ac1508.css" as="style"><link rel="preload" href="/assets/js/app.6cd6cd7e.js" as="script"><link rel="preload" href="/assets/js/4.f95145a6.js" as="script"><link rel="prefetch" href="/assets/js/10.a48c16b4.js"><link rel="prefetch" href="/assets/js/11.a5419096.js"><link rel="prefetch" href="/assets/js/12.0cbbfb64.js"><link rel="prefetch" href="/assets/js/13.b16df315.js"><link rel="prefetch" href="/assets/js/14.8b3ec47e.js"><link rel="prefetch" href="/assets/js/15.cabe99a1.js"><link rel="prefetch" href="/assets/js/16.a67cc252.js"><link rel="prefetch" href="/assets/js/17.ebb89b66.js"><link rel="prefetch" href="/assets/js/18.a53fbdf8.js"><link rel="prefetch" href="/assets/js/19.e80ac3d4.js"><link rel="prefetch" href="/assets/js/2.dbba3d8d.js"><link rel="prefetch" href="/assets/js/20.53051d6e.js"><link rel="prefetch" href="/assets/js/21.d29f15e7.js"><link rel="prefetch" href="/assets/js/22.0319bfb1.js"><link rel="prefetch" href="/assets/js/23.733b9128.js"><link rel="prefetch" href="/assets/js/24.6f9108aa.js"><link rel="prefetch" href="/assets/js/25.1213099a.js"><link rel="prefetch" href="/assets/js/26.274b0122.js"><link rel="prefetch" href="/assets/js/27.2639d4bf.js"><link rel="prefetch" href="/assets/js/28.b288a6e5.js"><link rel="prefetch" href="/assets/js/29.2fd2e932.js"><link rel="prefetch" href="/assets/js/3.091fb819.js"><link rel="prefetch" href="/assets/js/30.119e4149.js"><link rel="prefetch" href="/assets/js/31.432e6cb3.js"><link rel="prefetch" href="/assets/js/32.011184fe.js"><link rel="prefetch" href="/assets/js/33.00b83608.js"><link rel="prefetch" href="/assets/js/34.d802c816.js"><link rel="prefetch" href="/assets/js/35.33689142.js"><link rel="prefetch" href="/assets/js/36.dc93cc29.js"><link rel="prefetch" href="/assets/js/37.4d6aca58.js"><link rel="prefetch" href="/assets/js/38.5495d034.js"><link rel="prefetch" href="/assets/js/39.84dc2dc6.js"><link rel="prefetch" href="/assets/js/5.12543c1d.js"><link rel="prefetch" href="/assets/js/6.b216a31d.js"><link rel="prefetch" href="/assets/js/7.093a7fe1.js"><link rel="prefetch" href="/assets/js/8.e7981210.js"><link rel="prefetch" href="/assets/js/9.333127fc.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f9ac1508.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Wayshon 小站</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><a href="/archives.html" class="nav-link">归档</a></div><div class="nav-item"><a href="/about.html" class="nav-link">关于我</a></div><div class="nav-item"><a href="https://www.github.com/wayshon" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">side project</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://itunes.apple.com/cn/app/id1447258000" target="_blank" rel="noopener noreferrer" class="nav-link external">
  关心宝
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://imgqr.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  qr code
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://base64.imgqr.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  base64
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://calcbit.com/garbage-web/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  垃圾分类
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><a href="/archives.html" class="nav-link">归档</a></div><div class="nav-item"><a href="/about.html" class="nav-link">关于我</a></div><div class="nav-item"><a href="https://www.github.com/wayshon" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">side project</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://itunes.apple.com/cn/app/id1447258000" target="_blank" rel="noopener noreferrer" class="nav-link external">
  关心宝
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://imgqr.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  qr code
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://base64.imgqr.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  base64
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://calcbit.com/garbage-web/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  垃圾分类
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <!----> </div> <div class="page"> <div class="content"><h2 id="cordova搭配vue开发混合app实践"><a href="#cordova搭配vue开发混合app实践" aria-hidden="true" class="header-anchor">#</a> Cordova搭配Vue开发混合app实践</h2> <p><code>2016-12-15</code></p> <h3 id="概览"><a href="#概览" aria-hidden="true" class="header-anchor">#</a> 概览</h3> <ul><li><p>Cordova</p> <p>Cordova 能够将你的 HTML/JS 代码打包在一个原生的容器中运行，并且可以调用系统的各类软硬件接口（JavaScript API）。我们将这种架构称之为 <code>hybrid app</code> , 得益于这种架构，我们能将前端代码跨平台运行，并且得到接近原生应用的系统特性。最终发布到各大应用市场，包括苹果的 App Store。</p></li> <li><p>Cordova 插件</p> <p>Cordova 通过插件的生态系统为开发者提供了广泛的软硬件接口支持，诸如文件读写、推送通知、解压缩、通讯录等等。这种方式保证了在开发过程中按需引入相应的功能插件，同时也加快了插件的更新维护，减少代码冗余。Cordova 插件使用 CLI 的方式经过 NPM 管理依赖并安装，十分方便。</p></li> <li><p>Cross-walk Project</p> <p>Cross-walk 是英特尔开发的一款为HTML应用提供运行时环境的开源项目，它基于最新的 Chromium 核心开发，可以提供最新的 Web 特性和一致的兼容性。随着 Cordova Android 4.0.0+ 引入了对嵌入式 webview 的支持，现在你可以方便地在你的 Cordova 应用上使用 Crosswalk 的 webview。通过使用 Crosswalk 的 webview 插件，开发者可以享用远程调试的功能，前沿的 HTML5 特性，例如WebGL, WebAudio 和 WebRTC，以及在包括 Android 4.0 Ice Cream Sandwich(ICS) 在内的 Android 设备上性能的显著提升。</p></li> <li><p>Vue.js</p> <p>Vue.js 是一套构建用户界面的 渐进式框架。与其他重量级框架不同的是，Vue 采用自底向上增量开发的设计。Vue 的核心库只关注视图层，并且非常容易学习，非常容易与其它库或已有项目整合。另一方面，Vue 完全有能力驱动采用单文件组件和Vue 生态系统支持的库开发的复杂单页应用。基于 Vue 框架，开发单页面的 hybrid app 将会变的非常高效。</p></li> <li><p>CodePush</p> <p>CodePush 是微软提供的一项云服务，它为开发者提供了直接向用户推送热更新 (Hot-Code-Update) 的软件支持和 CDN 分发网络。CodePush 为 Cordova 开发者提供了插件，我们可以快速地植入应用中。它提供的特性包括：版本管理、灰度更新、紧急回滚、增量更新 (Diff) 等等。它的 CDN 是世界上最大的 CDN 服务商 Akamai 提供的，稳定性和速度可想而知。<em>未来可能收费</em></p></li></ul> <h3 id="初始化开发环境"><a href="#初始化开发环境" aria-hidden="true" class="header-anchor">#</a> 初始化开发环境</h3> <ol><li><p><strong>Nodejs 版本更新</strong> 使用 <code>node -v &amp;&amp; npm -v</code> 检查版本，如果低于 v6.0.0 和 v3.0.0，请使用 <code>n</code> 工具更新：<code>sudo npm install n -g &amp;&amp; n stable</code></p></li> <li><p><strong>NPM 包的源管理</strong> 实际使用中 npm 的源服务器位于美国，速度较慢，所以我们用阿里巴巴的 npm 源镜像替代默认源：<code>sudo npm install nrm -g &amp;&amp; nrm use taobao</code>，此操作将会将源地址设定为：<code>https://registry.npm.taobao.org/</code> ，服务器位于阿里云，速度飞快。</p></li> <li><p><strong>安装 Xcode （OS X 选装）</strong> 前往 Mac App Store 下载最新版 Xcode，并安装 Command Line Tools，便于在 iOS 模拟器中调试。</p></li> <li><p><strong>安装 Android Studio（必装）</strong> 前往 Android Studio <a href="https://developer.android.com/studio/index.html" target="_blank" rel="noopener noreferrer">官网<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 下载 Android Studio 并安装 SDK 24+，根据引导提示即可安装完成。缺少这一步将不能成功 build 和 run 项目。</p></li> <li><p><strong>新建 Cordova 项目</strong> 简单地按照官方文档新建项目：<a href="https://cordova.apache.org/docs/en/6.x/guide/cli/index.html" target="_blank" rel="noopener noreferrer">文档链接<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><strong>一点小麻烦</strong> 当你执行到 <code>cordova platform add android</code> 这一步时，可能会遇到卡在 <code>&gt; Configuring &gt; 0/2 projects</code> 长达几个小时之久。在此需要对 <code>cordova platform add android</code> 这个命令的原理做一个解释，它做了以下几件事：</p> <ul><li>创建 Android 项目框架和文件结构</li> <li>首次执行下载 gradle (专门用来管理 Android 项目 maven 包的工具）</li> <li>配置 build.gradle 构建脚本</li> <li>下载项目需要的 maven 包</li> <li>清理冗余的 Cordova Lib</li> <li>构建项目</li></ul> <p>可惜的是，gradle 似乎在下载 https 协议的时候有一些 bug，导致 maven 包不能成功下载。这时候需要一些奇技淫巧：</p> <ul><li>找到你的 gradle 目录，一般在 <code>~/.gradle/wrapper/dists/gradle-2.14.1-all/53l0mv9mggp9q5m2ip574m21oh/gradle-2.14.1/</code> 下。</li> <li>修改 <code>src/core/org/gradle/api/artifacts/ArtifactRepositoryContainer.java</code> 文件，把 <code>MAVEN_CENTRAL_URL</code> 变量修改为 <code>http://repo1.maven.org/maven2</code></li> <li>修改 <code>src/core/org/gradle/api/internal/artifacts/dsl/DefaultRepositoryHandler.java</code> 文件，把 <code>BINTRAY_JCENTER_URL</code> 变量修改为 <code>http://jcenter.bintray.com/</code></li> <li>重新构建 Android 项目，<code>cordova platform remove android &amp;&amp; cordova platform add android</code>，大功告成。</li></ul></li> <li><p><strong>运行示例项目</strong> 下面我们尝试在模拟器和安卓真机中调试：</p> <ul><li>iOS：<code>cordova run ios</code> 等待编译完成后会自动打开 iOS 模拟器</li> <li>Android：<code>cordova run android</code> 或 <code>cordova build android</code> 后在 <code>yourApp/platforms/android/build/outputs/apk</code> 目录中找到打包好的 apk 进行真机安装并调试。</li> <li>iOS 的真机调试需要开发者帐号并注册开发设备，在此不详述。</li></ul></li></ol> <h3 id="使用-cordova-插件引入-cross-walk-webview"><a href="#使用-cordova-插件引入-cross-walk-webview" aria-hidden="true" class="header-anchor">#</a> 使用 Cordova 插件引入 Cross-walk webview</h3> <p>在上一步中我们成功地让示例 html 文件跑在了 Cordova 环境中。但在实际开发中，会遇到 Android 系统版本落后，原生 webview 性能差兼容性差的问题，所以我们要用 Cross-walk 替换原生的 Android webview 来运行我们的项目。
Cross-walk 开发社区已经为我们准备好了 Cordova 插件，只需要运行：
<code>cordova plugin add cordova-plugin-crosswalk-webview@latest —save</code>
在这里需要说明的是，必须加上 <code>@latest</code> 后缀，安装 2.2.0+ 版本，否则会遇到 <a href="https://crosswalk-project.org/jira/browse/XWALK-7422" target="_blank" rel="noopener noreferrer">#XWALK-7422 <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 的问题。
成功安装后再次 <code>cordova build android</code>，你会发现输出了两个 apk 文件，一个对应 arm 平台，一个对应 x86 平台，体积相较原来的文件增加了 20Mb 左右，多出来的体积便是 crosswalk-webview 的 runtime。
你也可以在项目的 <code>config.xml</code> 中设置：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>cordova-plugin-crosswalk-webview<span class="token punctuation">&quot;</span></span> <span class="token attr-name">spec</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>~2.2.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>variable</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>XWALK_VERSION<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>22+<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>variable</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>XWALK_LITEVERSION<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>xwalk_core_library_canary:17+<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>variable</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>XWALK_COMMANDLINE<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>--disable-pull-to-refresh-effect<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>variable</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>XWALK_MODE<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>embedded<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>variable</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>XWALK_MULTIPLEAPK<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>把 <code>XWALK_MULTIPLEAPK</code> 的 value 设置为 false，即可打包出一个整合两个平台的 apk 包，当然，体积会暴增至 40Mb+。</p> <h3 id="使用-chrome-调试-cross-walk-webview-中的项目"><a href="#使用-chrome-调试-cross-walk-webview-中的项目" aria-hidden="true" class="header-anchor">#</a> 使用 Chrome 调试 Cross-walk webview 中的项目</h3> <p>由于 Cross-walk 基于 Chromium，天生便具有了 Chrome 远程调试的功能。
电脑连接 Android 手机并开启 USB 调试模式，打开你的 Cordova 项目后，在 Chrome 浏览器地址栏中输入 <code>chrome://inspect</code> ，选择你的设备，即可打开远程控制台，真机调试变得十分方便。Vue Devtool 同样可以在此使用。</p> <h3 id="ios-的小优化-将-uiwebview-替换为-wkwebview"><a href="#ios-的小优化-将-uiwebview-替换为-wkwebview" aria-hidden="true" class="header-anchor">#</a> iOS 的小优化 将 UIWebView 替换为 WKWebView</h3> <p>WKWebView 是苹果在 iOS 8 中引入的新组件，目的是给出一个新的高性能的 Web View 解决方案，摆脱过去 UIWebView 的老旧笨重特别是内存占用量巨大的问题（打开一个示例项目，WKWebView 占用23M，而 UIWebView 占用85M）。
在这里我们将使用 WKWebView 替换 Cordova 默认的 UIWebView：
<code>cordova plugin add cordova-plugin-wkwebview-engine@latest --save</code>
并在 config.xml 的 <code>&lt;platform name=&quot;ios&quot;&gt;</code>中添加：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>feature</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>CDVWKWebViewEngine<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ios-package<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>CDVWKWebViewEngine<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>feature</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="使用-cordova-插件的-javascript-api-调用系统原生接口"><a href="#使用-cordova-插件的-javascript-api-调用系统原生接口" aria-hidden="true" class="header-anchor">#</a> 使用 Cordova 插件的 JavaScript API 调用系统原生接口</h3> <p>可在<a href="https://cordova.apache.org/plugins/" target="_blank" rel="noopener noreferrer">插件搜索页<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>搜索需要的插件，以Camera<a href="https://www.npmjs.com/package/cordova-plugin-camera-all-files" target="_blank" rel="noopener noreferrer">插件链接<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>插件为例，在命令行进入项目所在文件夹，输入<code>cordova plugin add cordova-plugin-camera --save</code>
然后在页面的js部分先要添加：</p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code>document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;deviceready&quot;</span><span class="token punctuation">,</span> func<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>所有的插件都需要在func函数之后执行。
Camera的方法都定义在navigator对象上，Navigator对象包含有关浏览器的信息，所有浏览器都支持，在文件任何js部分调用navigator.xxx方法即可。
但并不是所有插件的方法都定义到navigator对象上，根据具体的插件文档而定。例如极光推送的插件<a href="https://github.com/jpush/jpush-phonegap-plugin" target="_blank" rel="noopener noreferrer">插件链接<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的方法都定义的window对象上。
之后的插件各种方法的使用可以参照对应插件的文档使用。</p> <h4 id="cordova-plugin-whitelist-和-csp-安全策略"><a href="#cordova-plugin-whitelist-和-csp-安全策略" aria-hidden="true" class="header-anchor">#</a> Cordova-plugin-whitelist 和 CSP 安全策略</h4> <p>出于安全考虑，Cordova 4.0 以上环境中，需要安装<code>cordova-plugin-whitelist</code>插件并 对 <code>config.xml</code> 中的 <code>&lt;access origin=&quot;your-policy&quot; /&gt;</code> 标签和 <code>index.html</code> 中的 <code>META</code> 标签做一定设置，防止出现共享 Webview 模式下的跨站攻击等安全问题。
运行：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>cordova plugin <span class="token function">add</span> cordova-plugin-whitelist --save
</code></pre></div><p>并编辑 <code>config.xml</code>：</p> <div class="language-xml extra-class"><pre class="language-xml"><code>    <span class="token comment">&lt;!--以下是开发环境配置，不对来源做任何限制，生产打包时需要设置--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>access</span> <span class="token attr-name">origin</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>*<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>allow-intent</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>*<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>allow-navigation</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>*<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><p>在 <code>index.html</code> 中添加：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!--同样，生产打包时需要严格设置--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Content-Security-Policy<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>default-src 'self' data: gap: cdvfile: https://ssl.gstatic.com 'unsafe-eval'; style-src 'self' 'unsafe-inline'; media-src *; font-src * data:; img-src *; script-src *;<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>CSP（Content-Security-Policy）的详细设置：</p> <ul><li>指令：
<img src="/assets/img/CSP-Policy.141dffc7.png" alt></li> <li>指令值：
<img src="/assets/img/CSP-Value.f0602763.png" alt></li></ul> <h3 id="vue-js-的分片打包模式"><a href="#vue-js-的分片打包模式" aria-hidden="true" class="header-anchor">#</a> Vue.js 的分片打包模式</h3> <p>在大型应用中，我们可能需要将应用拆分为多个小模块，按需从服务器下载。Vue.js 允许将组件定义为一个工厂函数，动态地解析组件的定义。工厂函数接收一个 resolve 回调，在收到从服务器下载的组件定义时调用。
在定义router的时候，可以给component属性一个工厂函数，<code>require.ensure</code>是commonjs异步加载方法，中括号中可以为空，这里写上相当于先加载，但没执行，下面的require才是执行。
<code>require.ensure</code>语法告诉 webpack，自动将编译后的代码分割成不同的块。
在命令行打包<code>npm run build</code>之后，在dist/static/js文件夹下会多出一个js文件和map文件 。</p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code>routes<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span>
    path<span class="token punctuation">:</span><span class="token string">'/example'</span><span class="token punctuation">,</span><span class="token function-variable function">component</span><span class="token punctuation">:</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> require<span class="token punctuation">.</span><span class="token function">ensure</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'../components/example.vue'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../views/example.vue'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>】
</code></pre></div><p>如果你在<code>require.ensure</code>的函数中引用了两个以上的模块，比如某个路由下的所有组件都打包在同个异步中，需要提供<code>require.ensure</code>第三个参数作为的名称,这时webpack会把它们打包在一起，比如：</p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code>require<span class="token punctuation">.</span><span class="token function">ensure</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">require</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> list <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./list'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    list<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> edit <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./edit'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    edit<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'all'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>list.js和edit.js将会被打包成一个文件，并命名为all.js。如果不希望打包在一起，只能写两个require.ensure分别引用这两个文件。
<strong>注意</strong> 如果希望生成的文件是我们给的Chunk，需要改一下webpack的配置，将build/webpack.prod.conf.js的第19行修改如下：</p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code>chunkFilename<span class="token punctuation">:</span> utils<span class="token punctuation">.</span><span class="token function">assetsPath</span><span class="token punctuation">(</span><span class="token string">'js/[name].js'</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="添加-codepush-热更新功能"><a href="#添加-codepush-热更新功能" aria-hidden="true" class="header-anchor">#</a> 添加 CodePush 热更新功能</h3> <p>为了实现本次 App 架构中的单个组件发布和热更新功能，引进了微软开发的 CodePush 工具。</p> <ul><li>运行：</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>cordova plugin <span class="token function">add</span> cordova-plugin-code-push@latest --save
</code></pre></div><ul><li>安装 code-push 命令行并注册帐号（仅开发试用，正式部署会有专门的帐号）：</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">npm</span> <span class="token function">install</span> -g code-push-cli
code-push register //你可以通过 Github 或者 微软帐号登录
code-push login //登录后会在本地生成 session 文件用来验证你的发布权限
</code></pre></div><ul><li>创建 app：</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>code-push app <span class="token function">add</span> <span class="token operator">&lt;</span>appName<span class="token operator">&gt;</span>
</code></pre></div><p>这一步会生成 key，将 staging 中的 key 复制到下一步使用。</p> <ul><li>在 app 的 <code>config.xml</code> 中配置你的部署 key：</li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>platform</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>android<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>preference</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>CodePushDeploymentKey<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>YOUR-ANDROID-DEPLOYMENT-KEY<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>platform</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>platform</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ios<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>preference</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>CodePushDeploymentKey<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>YOUR-IOS-DEPLOYMENT-KEY<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>platform</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>在你的 <code>index.html</code> 中允许安全策略，添加 <code>https://codepush.azurewebsites.net</code> 的域名：</li></ul> <div class="language- extra-class"><pre class="language-text"><code>&lt;meta http-equiv=&quot;Content-Security-Policy&quot; content=&quot;default-src https://codepush.azurewebsites.net ... /&gt;
</code></pre></div><ul><li>添加代码更新逻辑：</li></ul> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">// Application Constructor</span>
    <span class="token function-variable function">initialize</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'deviceready'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onDeviceReady</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token function-variable function">onDeviceReady</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token function-variable function">downloadProgress</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">progress</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Downloaded </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>progress<span class="token punctuation">.</span>receivedBytes<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> of </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>progress<span class="token punctuation">.</span>totalBytes<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        codePush<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>updateDialog<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> installMode<span class="token punctuation">:</span>InstallMode<span class="token punctuation">.</span><span class="token constant">IMMEDIATE</span><span class="token punctuation">,</span> mandatoryInstallMode<span class="token punctuation">:</span> InstallMode<span class="token punctuation">.</span><span class="token constant">IMMEDIATE</span><span class="token punctuation">}</span><span class="token punctuation">,</span> downloadProgress <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这时重新打包 app，并运行。</p> <ul><li>验证发布代码功能</li></ul> <p>修改你的任意代码后，运行：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>code-push release-cordova <span class="token operator">&lt;</span>appName<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>platform<span class="token operator">&gt;</span>

code-push release-cordova MyApp-ios ios
code-push release-cordova MyApp-Android android
</code></pre></div><ul><li>关闭 app 重新打开并测试更新是否成功
<img src="/assets/img/Screenshot-1.d14dd380.jpeg" alt></li></ul> <h3 id="自定义插件"><a href="#自定义插件" aria-hidden="true" class="header-anchor">#</a> 自定义插件</h3> <p>在实际项目中可能需要自己开发一些特殊的插件。这需要涉及到一些原生开发的知识。这里以开发iOS的插件为例。</p> <ul><li>首先，在任意目录下创建一个插件目录，如在desktop新建一个文件夹rayeye-TestPlugin，然后在com.anasit.callnative目录下新建src、www两个目录，src中存放的是对应平台的插件代码，www存放的是插件的js代码，再新建一个plugin.xml文件，写入的是插件的相关配置信息，本例只开发了iOS平台，所以在src下再新建ios目录。</li> <li>在www文件夹下创建testPlugin.js：</li></ul> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> argscheck <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cordova/argscheck'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    exec <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cordova/exec'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> <span class="token function-variable function">testPlugin</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">successCallback<span class="token punctuation">,</span> errorCallback<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    argscheck<span class="token punctuation">.</span><span class="token function">checkArgs</span><span class="token punctuation">(</span><span class="token string">'fFO'</span><span class="token punctuation">,</span> <span class="token string">'navigator.testPlugin'</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
    options <span class="token operator">=</span> options <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> getValue <span class="token operator">=</span> argscheck<span class="token punctuation">.</span>getValue<span class="token punctuation">;</span>
    <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token function">getValue</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>a<span class="token punctuation">,</span> <span class="token string">'aaa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token function">getValue</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>b<span class="token punctuation">,</span> <span class="token string">'bbb'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> args <span class="token operator">=</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">exec</span><span class="token punctuation">(</span>successCallback<span class="token punctuation">,</span> errorCallback<span class="token punctuation">,</span><span class="token string">&quot;testPlugin&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> testPlugin<span class="token punctuation">;</span>
</code></pre></div><ul><li>iOS native部分，在src/ios文件夹下新建 IosPlugin.h 和 IosPlugin.m文件：</li></ul> <div class="language-Objective-C extra-class"><pre class="language-text"><code>//  IosPlugin.h
#import &lt;Cordova/CDV.h&gt;
@interface IosPlugin : CDVPlugin
- (void)test:(CDVInvokedUrlCommand*)command;
@end
</code></pre></div><ul><li></li></ul> <div class="language-Objective-C extra-class"><pre class="language-text"><code>//  IosPlugin.m
#import &quot;IosPlugin.h&quot;
#import &lt;Cordova/CDV.h&gt;
@implementation IosPlugin
- (void)test:(CDVInvokedUrlCommand *)command{
    NSString *s1 = [NSString stringWithFormat:@&quot;%@&quot;, [command.arguments objectAtIndex:0]];
    NSString *s2 = [NSString stringWithFormat:@&quot;%@&quot;, [command.arguments objectAtIndex:1]];
    UIAlertView *alertview = [[UIAlertView alloc] initWithTitle:s1 message:s2 delegate:self cancelButtonTitle:@&quot;取消&quot; otherButtonTitles:@&quot;确定&quot;, nil];
    [alertview show];
}
@end
</code></pre></div><ul><li>编辑plugin.xml：</li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code> <span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://apache.org/cordova/ns/plugins/1.0<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>rayeye-TestPlugin<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>0.0.1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>rayeye-TestPlugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>Call Native Plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>license</span><span class="token punctuation">&gt;</span></span>Apache 2.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>license</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>keywords</span><span class="token punctuation">&gt;</span></span>call native<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>keywords</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>js-module</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>testPlugin<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>www/testPlugin.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>clobbers</span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>window.testPlugin<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>js-module</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>platform</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ios<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>config-file</span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>config.xml<span class="token punctuation">&quot;</span></span> <span class="token attr-name">parent</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/*<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>feature</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>testPlugin<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ios-package<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>IosPlugin<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>feature</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>config-file</span><span class="token punctuation">&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>header-file</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>src/ios/IosPlugin.h<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source-file</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>src/ios/IosPlugin.m<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>platform</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>在项目根目录下打开命令行，输入cordova plugin add rayeye-TestPlugin(注：根据自己设置的路径写)，按下回车后，插件就会自动安装到项目根目录下的plugins目录中。</li> <li>最后在页面文件中调用<code>window.testPlugin(successcallback, errorcallback, {a: &quot;111&quot;,b: &quot;222&quot;});</code>即可弹出一个原生的弹框。</li></ul> <h3 id="android-生产打包"><a href="#android-生产打包" aria-hidden="true" class="header-anchor">#</a> Android 生产打包</h3> <ul><li>从Android Studio的&quot;File&quot;-&gt;&quot;Open&quot;打开你的cordova项目下的/platforms/android。
<img src="/assets/img/openproject.d8473f24.png" alt></li> <li>选择&quot;Build&quot;-&gt;&quot;Generate Signed APK&quot;，点击&quot;next&quot;。
<img src="/assets/img/buildproject.aad4a1da.png" alt></li> <li>此处选择一个已有的签名，或者新建一个。点击&quot;next&quot;。
<img src="/assets/img/signproject.0ca0eb63.png" alt></li> <li>此处选择release生产版本，点击finish完成。
<img src="/assets/img/finishproject.671bf924.png" alt></li></ul> <h3 id="ios-生产打包"><a href="#ios-生产打包" aria-hidden="true" class="header-anchor">#</a> iOS 生产打包</h3> <ul><li>前提是在苹果开发者网<code>https://developer.apple.com/account/</code>站生成了需要的appid,证书和profile文件，不累述。</li> <li>在Display Name 修改应用名称。<img src="/assets/img/DisplayName.ea88342b.png" alt></li> <li>用Xcode打开工程，注意是.xcworkspace(白颜色)的工程，不是.xcodeproj(蓝颜色)的工程。</li> <li>在Resources/Images.xcassets里修改启动图片和应用图标，AppIcon是对应平台的图标，LaunchImage是启动图片。</li> <li>选择“Product”-&gt;&quot;Edit Scheme...&quot;，在“Build Configuration”中选择“Release”,单击&quot;Close&quot;。</li> <li>选择菜单栏中的&quot;Product&quot;-&gt;&quot;Archive&quot;，选择刚刚的工程，选择“Export...”，选择第一个(Save for iOS App Store Deployment)，点击Export。然后会生成一个文件夹，里面是ipa包。</li> <li>打开 Application Loader，选择“交付您的应用程序”，选取之前生成的ipa包，然后下一步。</li> <li>去<code>https://itunesconnect.apple.com/WebObjects/iTunesConnect.woa/ra/ng/</code>完成app相关信息的填写</li></ul> <h3 id="极光推送的使用"><a href="#极光推送的使用" aria-hidden="true" class="header-anchor">#</a> 极光推送的使用</h3> <ul><li>插件地址<code>https://github.com/jpush/jpush-phonegap-plugin</code></li> <li>安装:<code>cordova plugin add jpush-phonegap-plugin --variable API_KEY=your_jpush_appkey</code></li></ul> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code>document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;deviceready&quot;</span><span class="token punctuation">,</span> onDeviceReady<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;jpush.openNotification&quot;</span><span class="token punctuation">,</span> onOpenNotification<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//点击通知启动或唤醒应用程序时会出发该事件</span>
document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;jpush.receiveNotification&quot;</span><span class="token punctuation">,</span> onReceiveNotification<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//应用程序处于前台时收到推送会触发该事件</span>
document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;jpush.backgroundNotification&quot;</span><span class="token punctuation">,</span> onBackgroundNotification<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//后台收到推送,不知道何用，处在后台还能干嘛吗</span>
document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;jpush.receiveMessage&quot;</span><span class="token punctuation">,</span> onReceiveMessage<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//收到自定义消息</span>
</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.6cd6cd7e.js" defer></script><script src="/assets/js/4.f95145a6.js" defer></script>
  </body>
</html>
